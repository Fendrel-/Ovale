import { readdirSync, readFileSync, writeFileSync } from "fs";
import { join, parse, normalize, dirname } from "path";
import { LocalizationStrings } from "../ui/localization/definition";

const basePath = "src/ui/localization/source";
const dir = readdirSync(basePath);
for (const file of dir) {
    const path = join(basePath, file);
    const data = readFileSync(path, { encoding: "utf8" });
    if (data) {
        const { name } = parse(file);
        const json: LocalizationStrings = JSON.parse(data);
        const functionName = name.replace("-", "").toUpperCase();

        if (name === "en-US") {
            const text = `// DO NOT EDIT THIS FILE. Edit the ${name}.json file and run yarn localize
import { LocalizationStrings } from "./definition";

export function get${functionName}(): Required<LocalizationStrings> {
    return {
${Object.entries(json)
    .map(([key, value]) => `        ${key}: \`${value}\`,\n`)
    .join("")}
    };
}`;
            const output = normalize(`${dirname(path)}/../${name}.ts`);
            writeFileSync(output, text, { encoding: "utf8" });
        } else {
            const text = `// DO NOT EDIT THIS FILE. Edit ${name}.json file and run yarn localize
import { LocalizationStrings } from "./definition";

export function set${functionName}(L: LocalizationStrings) {
${Object.entries(json)
    .map(([key, value]) => `    L.${key} = \`${value}\`;\n`)
    .join("")}
}`;
            const output = normalize(`${dirname(path)}/../${name}.ts`);
            writeFileSync(output, text, { encoding: "utf8" });
        }
    }
}
